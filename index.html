<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <title>Random Psalm</title>
  </head>

  <body>
    <main>
      <div class="toggle">
        <span>‚òÄÔ∏è</span>
        <input type="checkbox" id="modeSwitcher" />
        <label for="modeSwitcher">
          <span class="screen-reader-text">Dark Mode</span>
        </label>
        <span>üåô</span>
      </div>

      <h1>Random Psalm Generator</h1>
      <div id="content"></div>
    </main>

    <script>
      // Variables
      var contentArea = document.querySelector("#content");
      var randomChapter = randomNumber(1, 150);
      var modeSwitcher = document.querySelector("#modeSwitcher");
      var localStorageDarkMode = "randomPsalm_darkMode";

      // Methods
      function randomNumber(min, max) {
        return Math.floor(Math.random() * (max - min + 1) + min);
      }

      function handleResponse(response) {
        if (response.ok) {
          return response.json();
        } else {
          return Promise.reject(response);
        }
      }

      function showPsalm(data) {
        contentArea.innerHTML = data.msg.passages[0];
      }

      function handleError(err) {
        console.warn("Error:", err);
      }

      function checkLocalStorage() {
        if (localStorage.getItem(localStorageDarkMode) === "true") {
          // if true, then we're in dark mode (since light mode is default)
          modeSwitcher.checked = true;
          document.body.classList.add("dark");
        }
      }

      function eventHandler(event) {
        if (event.target.checked) {
          localStorage.setItem(localStorageDarkMode, true);
          document.body.classList.add("dark");
        }
        if (!event.target.checked) {
          localStorage.setItem(localStorageDarkMode, false);
          document.body.classList.remove("dark");
        }
      }

      // On load, get localStorage value
      checkLocalStorage();

      // Fetch psalm
      fetch(`/.netlify/functions/getpassage?q=Psalm+${randomChapter}`)
        .then(handleResponse)
        .then(showPsalm)
        .catch(handleError);

      // Events
      modeSwitcher.addEventListener("change", eventHandler);
    </script>
  </body>
</html>
